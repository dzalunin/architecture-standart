### <a name="_b7urdng99y53"></a>**Название задачи: Открытие депозитов online и передача ставок в call-центры** 
### <a name="_hjk0fkfyohdk"></a>**Автор:**
### <a name="_uanumrh8zrui"></a>**Дата:**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
| UC4 | Сотрудник бэк офиса,<br>система call-центра,<br>сервис ставок | Предоставление информации по текущим ставкам | Сотрудник бэк офиса обновил ставки<br>2. Сервисы ставок отправляет сообщение с изменениями в брокер<br>3. Система call-центра считывает ставки из брокера и обновляет свои данные |
| UC5 | Сотрудник бэк офиса,br>сервис ставок, <br>сервис интеграции, <br>Система партнерского call-центра,<br>сервис ставок | Предоставление информации по текущим ставкам партнерскому call-центру | Сотрудник бэк офиса обновил ставки<br>2. Сервисы ставок отправляет сообщение с изменениями в брокер<br>3. Сервис интеграции считывает ставки из брокера, формирует xml файл по заранее согласованной xsd схеме, выкладывает его на ftp сервер <br>4. Партнерская система call-центра забирает файл и обновляет данные по ставкам |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

|**№**|**Требование**|
| :-: | :- |
| +R1 | Обновление данных происходит раз в сутки |
| +R2 | Доступ к ftp из интернет возможен только с ip адресов партнерского call центра, трафик защищен SSL |
### <a name="_qmphm5d6rvi3"></a>**Решение**
[Диаграмма контекста](./context.puml)  
[Диаграмма контейнеров](./containers.puml)

- Брокер сообщений (kafka) — используется как надёжный брокер сообщений между сервисами. 
- XML + XSD — Использование xsd позволяет получить структурированный формат обмена, документацию к нему. 
- Сервис интеграции — вынос формирования XML в отдельный контейнер обеспечивает гибкость при изменении форматов, не затрагивая основную бизнес-логику.
- FTP с SSL + IP-фильтрация - относительно безопасное решение для обмена данными с минимальными трудозатратами.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
- Использовать email как канал связи для отправки данных партнерскому call-центру. Есть риск недоставки данных (например письмо попало в спам или сработало ограничение на размер вложения).
- Не создавать сервис интеграции, формировать файл в сервисе ставок. При необходимости изменить формат передачи данных придется трогать сервис ставок.

**Недостатки, ограничения, риски**
- Любой сотрудник из сети партнерского call центра зная креды от ftp может получть файл с изменениями ставок.
